---
title: "Report2"
author: "Sander Miesen, Gaelle Verdon, Emma Boehly, Constance de Trogoff"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r import, include=FALSE}
 load("projectData.RData")
```

# Introduction

Investigating the causes of crime is a complicated task. Indeed, many external factors, such as civil wars and worker strikes could influence any region’s crime rates drastically, and these factors are hard to control for. Our dataset, collected by John Clay between 1849 and 1853, has the particularity of having very few of those disturbances as there were, in his own words, “no political or social excitement [and] no cessation of the employment”. Additionally, in 1851 there was a Census, thus making the recording of the number of inhabitants as accurate as possible. These two factors make this an ideal case study, controlling for many external variables.

In this report, we aim to investigate how counties’ number of criminals per 100’000 inhabitants are affected by the number of ale and beer houses per 100’000 inhabitants, as well as the number of people attending at school per 10’000 inhabitants and the number of people attending at public worship per 2’000 inhabitants. These variables are interesting as they relate to three more general socio-cultural themes which often come up when talking about crime, namely drunkenness, education and religion. Through the running of regression models, we hope to find significant relationships between the variables and the crime rate, which could eventually help set up measures to decrease it.


# EDA

```{r str, echo=FALSE}
 str(data)
```

(We could observe that Criminals per 100k are considered as character although they are discrete data. Thus we converted them to integer.
Furthermore, region_name and region_code were identified as characters although they are factors. Thus we converted them to factors.)

```{r convert, include=FALSE}
data$criminals_per_100k <- as.integer(data$criminals_per_100k)
data$region_code <- as.factor(data$region_code)
data$region_name <- as.factor(data$region_name)
str(data)
attach(data)
```

To start our data exploration, we first performed a univariate data analysis of the predictors and of the response variable of interest meaning the number of criminals per 100k per county. We have 3 numerical features : the number of Ale beer houses per 100k per county, the of public school attendants per 100k per county, and the number of public worship attendants per 100k per county, and 3 categorical features : the county names, the region names and the region codes. By observing the data, we could notice that each sample corresponds to a different county name and thus we ignored this last feature for the following of our analysis. We could also remark that each region name corresponds to a region code, except for "South Midland" which had the same region code as "South Eastern". We thus replaced the region_code "1" of South Eastern to factor "0". Proportions of categorical features are indicated in Table 1. (Faire un tableau latex)

```{r heatmap, include=FALSE}

cont_table = table(data$region_name, data$region_code)
# Convert the table to a matrix
cont_matrix <- as.matrix(cont_table)

colors <- colorRampPalette(c("lightyellow", "blue"))(100)

# Create the heatmap
heatmap(cont_matrix, 
        col = colors, 
        scale = "none",  # To prevent scaling of values
        Rowv = NA,       # To suppress row dendrogram
        Colv = NA,       # To suppress column dendrogram
        margins = c(5, 5))  # Set margins

# Add a color key
legend("bottomleft", legend = c("0", "Above 0"), fill = c("lightyellow", "blue"), bty = "n")

```

```{r summary2, echo=FALSE}
data$region_code <- factor(data$region_code, levels = c(levels(data$region_code), "0"))
data[data$region_name == "South Eastern", "region_code"] <- factor("0")
attach(data)

categorical_features <- sapply(data, function(x) is.factor(x) | is.character(x))
categorical_data <- data[, categorical_features]

summary(categorical_data)
```

We first computed informations about the center of each numerical predictors distribution (the mean and the median), and about the spread (with the minimum and maximum value, the lower percentile 25 and the upper percentile 75 as well as the standard deviations). Results are displayed in Table 2.

Faire un tableau latex avec les données suivantes en rajoutant Standard deviation (SD), Interquartile range (IQR), Median Absolute Deviation (MAD)
```{r summary, echo=FALSE}
# Assuming 'data' is your dataset

# Extract numerical features and corresponding data
numerical_features <- sapply(data, is.numeric)
numerical_data <- data[, numerical_features]

summary(numerical_data)
```

While the mean is very sensitive to outliers, the median is not. Thus by comparing the two, we can have insights on the presence of outliers. We can observe that the mean and the median are quite similar relative to the spread for all three numerical features, infering against the presence of outliers. In order to have a visual summary of the distributions, boxplot of the predictors are shown in Figure 1. They appear to be quite symmetric, while being slightly left-skewed for the Beer Houses, and the Worship attendants and slightly right-skewed for the Public School attendants. 

```{r boxplots2, echo=FALSE}
library(packHV)
layout(matrix(c(1, 1, 2), nrow = 1), widths = c(1.25, 1))

# Creating a single boxplot with different colors for each feature
boxplot(ale_beer_houses_per_100k, 
        attendants_public_school_per_10k, 
        attendants_public_worship_per_2k, 
        main = "Comparison of Various Features per County",
        names = c("Beer Houses", "School Attendants", "Worship Attendants"),
        ylab = "Count per 100k")
hist_boxplot(criminals_per_100k, breaks=20, ymax=6)
```

Next, to better visualize the response variable of interest, i.e. the number of criminals per county per 100k, we plotted its distribution with a histogran and a boxplot in Figure 2 which is slightly left skewed. For a first naive comparison of its distribution across regions, we displayed seperate boxplots for each region in Figure 3. We could observe clear differences between the number of criminals' median and us ordered them in ascending order. As we can hypothesize a statistical difference between region 8 (corresponding to "Northern") which as a median number of criminals lower than 100, and region 4 (corresponding to West Midland) which has a median number of criminal higher than 200, we compared the predictor's distribution of those 2 regions in Figure 4.


```{r bivariate boxplot, echo=FALSE}
factor_colors <- c("red", "cyan", "magenta", "orange", "purple", "yellow", "pink", "green", "blue")

# Order region codes by median value
ordered_region <- names(sort(tapply(criminals_per_100k, region_code, median)))

# Create boxplots ordered by median
boxplot(criminals_per_100k ~ factor(region_code, levels = ordered_region), 
        main = "Criminals per 100k by Region Code",
        col = factor_colors,
        xlab = "Region Code",
        ylab = "Criminals per 100k")

```
```{r dist,echo=FALSE}
factor_colors <- c("blue", "red")
subset_data <- data[data$region_code %in% c(factor("4"), factor("8")), ]
subset_data$region_code <- factor(subset_data$region_code, levels = c(factor("4"), factor("8")))

par(mfrow=c(1,3))
boxplot(subset_data$ale_beer_houses_per_100k ~ subset_data$region_code, main = "", col = factor_colors, xlab="Region code")
boxplot(subset_data$attendants_public_school_per_10k ~ subset_data$region_code, main = "", col = factor_colors, xlab = "Region code")
boxplot(subset_data$attendants_public_worship_per_2k ~ subset_data$region_code, main = "", col = factor_colors, xlab ="Region code")
```


```{r correlation3, echo=FALSE, warning=FALSE}
factor_colors <- c("pink", "purple", "yellow", "orange", "blue", "magenta", "green", "cyan", "red")
# Customize upper panel
upper.panel<-function(x, y){
  points(x,y, pch=19, col=factor_colors[data$region_code])
  r <- round(cor(x, y), digits=2)
  txt <- paste0("R = ", r)
  usr <- par("usr"); on.exit(par(usr))
  par(usr = c(0, 1, 0, 1))
  text(0.5, 0.9, txt)
}
pairs(data[,5:7], lower.panel = NULL, 
      upper.panel = upper.panel)

```
```{r test, include=FALSE}

plot(criminals_per_100k~attendants_public_worship_per_2k)
plot(criminals_per_100k~ale_beer_houses_per_100k)
print(factor_colors[data$region_code])
print(data)
```